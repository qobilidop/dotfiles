#!/usr/bin/env bash
set -e
cd "$(dirname "$0")"/..

# Deploy dotfiles to home directory
function deploy() {
    # Deploy a directory of dotfiles to another location
    local SRC_DIR="$1"
    SRC_DIR="$(cd "$SRC_DIR" >/dev/null && pwd)"
    local DST_DIR="$2"
    shopt -s dotglob
    for SRC in "$SRC_DIR"/*; do
        DST="$DST_DIR/$(basename "$SRC")"
        if [[ -f "$SRC" || -L "$SRC" ]]; then
            rm -rf "$DST"
            mkdir -p "$DST_DIR"
            ln -s "$SRC" "$DST"
        elif [[ -d "$SRC" ]]; then
            deploy "$SRC" "$DST"
        fi
    done
    shopt -u dotglob
}
deploy home ~

# Configure global gitignore
source "$HOME/.zshenv"
GITIGNORE="$LOCAL/opt/gitignore"
./script/git-sync https://github.com/github/gitignore.git "$GITIGNORE"
cat "$GITIGNORE"/Global/{macOS,VisualStudioCode}.gitignore > ~/.gitignore_global
